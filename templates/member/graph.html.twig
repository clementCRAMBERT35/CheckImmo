{% extends 'base.html.twig' %}

{% block title %}Hello MemberController!{% endblock %}

{% block body %}
    <div id="main">
        <div class="inner">
            <h1>Graphique</h1>
            <input id="save-pdf" type="button" value="Sauvegarder"/>
            <div id="linechart_material"></div>
            <table id="tab">
                <tr>
                    <td>Date</td>
                    <td>Prix Minimum</td>
                    <td>Prix Maximum</td>
                    <td>Prix Moyen</td>
                </tr>
                {% for data in datas %}
                    <tr>
                        <td>{{ data.0 }}</td>
                        <td>{{ data.1 }}</td>
                        <td>{{ data.2 }}</td>
                        <td>{{ data.3 }}</td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages': ['corechart']});
        google.charts.setOnLoadCallback(drawChart);


        function drawChart() {

            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Jour');
            data.addColumn('number', 'Prix minimum');
            data.addColumn('number', 'Prix maximum');
            data.addColumn('number', 'Prix moyen');

            data.addRows({{ data|raw }});

            const options = {
                chartArea: {
                    bottom: 24,
                    left: 100,
                    right: 12,
                    top: 48,
                    width: '100%',
                    height: '100%'
                },
                legend: {position: 'top'},
                height: 600,
                title: 'Evolution des différents prix sur le marché en euro (€)',
            };


            const chart_area = document.getElementById('linechart_material');
            var chart = new google.visualization.LineChart(chart_area);

            var btnSave = document.getElementById('save-pdf');

            google.visualization.events.addListener(chart, 'ready', function () {
                btnSave.disabled = false;
            });

            btnSave.addEventListener('click', function () {
                var pdf = new jsPDF('l', '', '');
                pdf.addImage(chart.getImageURI(), 0, 0, 290, 200);
                pdf.addPage();
                pdf.autoTable({html: '#tab'})
                pdf.save('Rapport.pdf');
            });

            chart.draw(data, options);
        }

    </script>
{% endblock %}

